<!DOCTYPE html>
<html><meta charset="utf-8">
 <head><title>folio</title>
  <script src='https://code.jquery.com/jquery-3.3.1.min.js'></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
  <script src="record.js"></script>
 <style>
   #debt {
     position: absolute;
     left: 50%;
     top : 0%;
     transform: translate(-50%, 0%);
     width : 45%;
     height: 45%;
     border: 1px solid rgba(1,1,1,0);
   }
   #canvas-holder {
     position: relative;
   }
 </style>
 </head>
 <body>
   <div id='background'></div>
   <div id='debt'>
     <div id='canvas-holder'>
     <canvas id='debt-canvas' width='500' height='500'></canvas>
     </div>
   </div>
 </body>
<script>

processData = function() {
  var cum    = 0
  var output = []
  var lines  = record.split('\n')
  
  for (var i = lines.length - 1; i > -1; i--) {
    var line = lines[i]
    items = line.split(/\s+/g)
    if (items.length < 3) { } else {
      var date       = items[0]
      var amount     = parseFloat(items[1])
      var type       = items[2]
      cum = cum + (type == "D" ? amount : type == "C" ? -amount : 0)
      output.push({date: date, amount: amount, type: type, cumulative: parseFloat(cum.toFixed(2)) })
    }
  }
  console.log(output)
  
  var dates = []
  var cumul = []
  var maxDate = new Date()
  output.forEach(function(ea) {
    var d = ea.date.split('/')
    var e = new Date()
        e.setUTCFullYear(parseInt(d[2]), parseInt(d[1]) - 1, parseInt(d[0]))
    if (e > maxDate) { maxDate = e }
    //dates.push(ea.date)
    dates.push(e)
    cumul.push(ea.cumulative)
  })
  
  wx.data  = output
  wx.dates = dates
  wx.cumulative = cumul
 
  var dv = new Date()
  var yr = dv.getFullYear()
  var mn = dv.getMonth() + 1
  var dy = dv.getDate()
  var _s = maxDate // dy.toString().padStart(2,'0') + '/' + mn.toString().padStart(2,'0') + '/' + yr
  wx.dates.push(_s)
  wx.cumulative.push(wx.cumulative[wx.cumulative.length - 1])
}


wx = {}

wx.draw = function() {
 data = [0.4,0.7,3,4,5]
 options = {}
 
 var ctx = $('#debt-canvas');
 var myChart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: wx.dates,
    datasets: [{ 
        data: wx.cumulative,
        label: "Newcastle",
        borderColor: "#3e95cd",
        fill: false,
      }
    ]
  },
  options: {
    title: {
      display: true,
      text: 'Debt'
    },
    scales: {
      yAxes: [{
        ticks: {
          max: -00000,
          // beginAtZero: true
        }
      }],
      xAxes: [{
        type: 'time',
      }]
    }
  }
});
}

window.onload = function() {
  processData()
  wx.draw()
}

/*
   instrument
   edge
   direction
   open price
   target
   stop
   opportunity
   risk reward
   value area
   sell extreme
   % risk
   ava position size
   score 80/20
   comment

   execution
 */
</script>
</html>
